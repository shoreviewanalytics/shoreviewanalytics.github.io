<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Staticman API Dokku Deployment - SHOREVIEWANALYTICS.GITHUB.IO</title>
<meta name="description" content="Using Dokku to deploy the Staticman API">


  <meta name="author" content="CHAD DOWNEY, M.SC. IT">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="SHOREVIEWANALYTICS.GITHUB.IO">
<meta property="og:title" content="Staticman API Dokku Deployment">
<meta property="og:url" content="https://shoreviewanalytics.github.io/Staticman-API-Dokku-Deployment/">


  <meta property="og:description" content="Using Dokku to deploy the Staticman API">







  <meta property="article:published_time" content="2018-10-08T00:00:00-04:00">





  

  


<link rel="canonical" href="https://shoreviewanalytics.github.io/Staticman-API-Dokku-Deployment/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Chad Downey",
      "url": "https://shoreviewanalytics.github.io/"
    
  }
</script>


  <meta name="google-site-verification" content="googlef0fa90c52d6664f6" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="SHOREVIEWANALYTICS.GITHUB.IO Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://shoreviewanalytics.github.io/">SHOREVIEWANALYTICS.GITHUB.IO</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://shoreviewanalytics.github.io/posts/" >Posts</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://github.com/shoreviewanalytics" >Repo</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://shoreviewanalytics.github.io/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Staticman API Dokku Deployment</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">CHAD DOWNEY, M.SC. IT</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">USA</span>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/chad-downey-48646812" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/shoreviewanalytics" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Staticman API Dokku Deployment">
    <meta itemprop="description" content="Using Dokku to deploy the Staticman API">
    <meta itemprop="datePublished" content="October 08, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Staticman API Dokku Deployment
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="using-dokku-to-deploy-the-staticman-api">Using Dokku to deploy the Staticman API</h2>

<p>If you are using the public (GitHub hosted) version of <a href="https://github.com/eduardoboucas/staticman" title="Staticman API ">Staticman API</a>, you might have noticed that due to its popularity and GitHub API limits, it has become more difficult to use it as a comments engine for your blog or website.  Perhaps you’ve experienced the  <a href="https://github.com/eduardoboucas/staticman/issues/227" title="Invitation not found">‘Invitation not found’</a> or the ‘Too many requests at this time’ message when trying to use the public version of Staticman. As of September 2018, the author of the minimal-mistakes Jekyll theme, which I’m using for this blog and the author of the Staticman API, recommend deploying a standalone instance of the Staticman API to avoid the GitHub API limits. This post discusses the general process I used to get the Staticman API up and running within a cloud infrastructure, so it can supply a ‘static comments engine’ for my blog hosted on <a href="https://pages.github.com/" title="Github Pages">Github Pages</a>.</p>

<h2 id="setup-needs">Setup Needs:</h2>

<ul>
  <li>
    <p>A domain name and a way to manage it, so you can create a subdomain like staticman.shoreviewanalytics.com.</p>
  </li>
  <li>
    <p>Create an account with digitalocean to create a Dokku droplet or similar setup.</p>
  </li>
  <li>
    <p>Create a Dokku droplet with your digital ocean account.</p>
  </li>
  <li>
    <p>Create an additional GitHub account.  This account will be the collaborator to your blog repository and will be used to create a GitHub token.</p>
  </li>
  <li>
    <p>Install npm on your workstation, so you can run the tests provided with Staticman and to install json to format .json files.</p>
  </li>
</ul>

<p>Now the fun begins.  If you have all the setup needs and are familiar with git, you should be able to work towards a successful deployment of Staticman API to a digitalocean Dokku droplet using the following steps.</p>

<p><strong>Step 1</strong></p>

<p>Create a Dokku droplet and do the basic server configuration.  Use your domain to create a subdomain that points to this droplet. After you complete this step you should be able to ssh to your droplet using at least one account and you should be able to ping your droplet at staticman.yourdomain.com.</p>

<p><strong>Step 2</strong></p>

<p>Fork the Staticman API repository.  I actually forked a repository that had already been forked from the original Staticman API.  I did this because after doing some recon, I found only one <a href="https://www.flyinggrizzly.net/2017/12/setting-up-staticman/" title="Setting up Staticman for comments on a Jekyll blog">example</a> of a standalone version of Staticman API using Dokku.  After trying to deploy a few times using the vanilla repository and failing, I wanted to start from a version of the code that had been successfully deployed. I believe the main reason why the deploy was failing is because of the Docker deployment files, so forking the current repository should be fine.</p>

<p><strong>Step 3</strong></p>

<p>Clone your forked version of Staticman API from your GitHub account to your local environment.</p>

<p><strong>Step 4</strong></p>

<p>Create a new local branch for the cloned repository that you forked on your workstation.  Don’t forget to checkout your new branch for your edits. Also, if you didn’t fork a repository that had the docker files removed, then go ahead and remove them now and then update your local branch repository.  This step is really important since to deploy Staticman you will need to have a GitHub token and a ssh key to add to a configuration file. The goal here, at least based on my understanding is that you don’t want to push any secrets out to GitHub.  If you do, you will get a nice little message from them saying you have sensitive information like a GitHub token and they will disable it so you will have to create another one.</p>

<p><strong>Step 5</strong></p>

<p>Use your second GitHub account and add it as a collaborator to your GitHub Pages blog repository.  Also create a GitHub token from this account to be used in the config.production.json file in Step 6.</p>

<p><strong>Step 6</strong></p>

<p>If you look at the root directory in your staticman folder you will see a file called config.sample.json.  Copy this file to a file named config.production.json. Now that you have this new file you can edit it using the GitHub token and a valid ssh key.  GitHub provides the documentation on how to create a token and how to create an ssh key.  I found that converting the standard key to .pem file works best.  After creating the config file and obtaining the token and key add them to this file.  Just be sure to use the ssh key from your GitHub account that holds your blog and use the token from the second GitHub account. Also when creating a ssh key, you should create one without a passphrase.</p>

<p><strong>Step 7</strong></p>

<p>Now you should be close to pushing Staticman API, your forked / cloned version of Staticman that you’ve edited in your local branch to your Dokku droplet. Commit the changes made to config.production.json in the local branch.</p>

<p><strong>Step 8</strong></p>

<p>Go to the Dokku droplet and create a Dokku application called staticman in all lower case letters.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dokku apps:create staticman
</code></pre></div></div>

<p><strong>Step 9</strong></p>

<p>Now setup a remote git repository for your Doku server on your workstation, by using the following command.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote add dokku dokku@yourserver:staticman
</code></pre></div></div>
<p>You can check to see what remote repositories you can push to using this command.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote -v
</code></pre></div></div>
<p>Push the local branch you created earlier to your remote repository on your Dokku droplet.  Notice you are NOT pushing the master branch that you haven’t updated.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push dokku local:master
</code></pre></div></div>
<p>This is where you find out if you have correctly edited the config.production.json file.  If you are in doubt on whether you have a good format for your config.production.json file use the following command to check it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>json -f config.production.json  
</code></pre></div></div>

<p><strong>Step 10</strong></p>

<p>This is where it really gets cool.  You can now push Staticman to your Dokku droplet with the following command assuming you named your local git branch “local”.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push dokku local:master  
</code></pre></div></div>

<p>Now if all goes well you will have pushed your local branch of Staticman to your Dokku server.  If you have your DNS setup correctly you should be able to navigate to your Staticman API deploy by opening up a browser and typing in staticman.yourdomain.com.  For me it’s staticman.shoreviewanalytics.com.</p>

<p><strong>Step 11</strong></p>

<p>Now that you have Staticman up and running you need to activate it so it can work with your blog.  To do this as provided in Staticman API documentation navigate to the an address like the following that makes sense for your deployment.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://staticman.yourdomain.com/v2/connect/yourgithubusername/yourgithubpagesblog.github.io  
</code></pre></div></div>

<p>If all goes well you should get a response of ‘OK’.  If you don’t there’s something wrong and you’ll need to dig in a bit.  In my case I had to dig in a lot.</p>

<p><strong>Step 12</strong></p>

<p>Now that you have a working deploy of Staticman so you can navigate to it as in Step 9, it’s time to add the ability to navigate to the Staticman URL using HTTPS.  To do this you need to issue the following commands on your Dokku droplet server.  Essentially, if you don’t add this you won’t be able to use your comments so don’t skip it. This step depends on dokku-letsencrypt.</p>

<p>first get it</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git
</code></pre></div></div>
<p>set an email address for notifications</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	dokku config:set --no-restart staticman DOKKU_LETSENCRYPT_EMAIL=your email address goes here
</code></pre></div></div>
<p>enable it</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	dokku letsencrypt staticman
</code></pre></div></div>

<p>set up auto-renewal:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	dokku letsencrypt:cron-job --add
</code></pre></div></div>

<p>Well, this post doesn’t include all the details you will need, but if you review the content from the references below and are able to complete the above steps, you should be able to get a working deployment of the Staticman API on a digitalocean Dokku droplet.  If you to try this out and get stuck and want some clarification, guess what, you can use the comments form below to get in touch with me.</p>

<h2 id="references">References:</h2>

<p><a href="https://staticman.net/docs/" title="Staticman Documentation">Staticman Documentation</a></p>

<p><a href="https://medium.com/@pimterry/effortlessly-add-https-to-dokku-with-lets-encrypt-900696366890" title="Effortlessly add HTTPS to Dokku, with Let’s Encrypt">Effortlessly add HTTPS to Dokku, with Let’s Encrypt</a></p>

<p><a href="https://mademistakes.com/articles/improving-jekyll-static-comments/" title="Improving static comments with Jekyll &amp; Staticman">Improving static comments with Jekyll &amp; Staticman</a></p>

<p><a href="http://dokku.viewdocs.io/dokku~v0.12.13/deployment/application-deployment/" title="Deploying to Dokku">Deploying to Dokku</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-10-08T00:00:00-04:00">October 08, 2018</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Staticman+API+Dokku+Deployment%20https%3A%2F%2Fshoreviewanalytics.github.io%2FStaticman-API-Dokku-Deployment%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fshoreviewanalytics.github.io%2FStaticman-API-Dokku-Deployment%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fshoreviewanalytics.github.io%2FStaticman-API-Dokku-Deployment%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://shoreviewanalytics.github.io/Spark-Logback-Example-Two/" class="pagination--pager" title="Spark Logback Example Two
">Previous</a>
    
    
      <a href="https://shoreviewanalytics.github.io/Fixing-The-401-Unauthorized-Message-After-Installing-Tomcat9-On-Ubuntu-18.04/" class="pagination--pager" title="Fixing The 401 Unauthorized Message After Installing Tomcat 9 On Ubuntu 18.04
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Fixing-The-401-Unauthorized-Message-After-Installing-Tomcat9-On-Ubuntu-18.04/" rel="permalink">Fixing The 401 Unauthorized Message After Installing Tomcat 9 On Ubuntu 18.04
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Spark-Logback-Example-Two/" rel="permalink">Spark Logback Example Two
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Spark Logback Example Two

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Spark-Logback-Example-One/" rel="permalink">Spark Logback Example One
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Spark Logback Example One

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/How-To-Become-A-Data-Analyst-Data-Scientist-or-Data-Engineer/" rel="permalink">How to become a Data Scientist, Data Analyst, Data Engineer or Machine Learning Engineer
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">How to become one of the (The Big 4)

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
    
        <li><a href="https://www.linkedin.com/in/chad-downey-48646812"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
    
    
    
    
      <li><a href="https://github.com/shoreviewanalytics"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="https://shoreviewanalytics.github.io/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Chad Downey. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>







    
  <script>
    (function ($) {
    $('#new_comment').submit(function () {
      var form = this;

      $(form).addClass('disabled');
      $('#comment-form-submit').html('<i class="fas fa-spinner fa-spin fa-fw"></i> Loading...');

      $.ajax({
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        data: $(this).serialize(),
        contentType: 'application/x-www-form-urlencoded',
        success: function (data) {
          $('#comment-form-submit').html('Submitted');
          $('.page__comments-form .js-notice').removeClass('notice--danger');
          $('.page__comments-form .js-notice').addClass('notice--success');
          showAlert('Thanks for your comment! It will show on the site once it has been approved.');
        },
        error: function (err) {
          console.log(err);
          $('#comment-form-submit').html('Submit Comment');
          $('.page__comments-form .js-notice').removeClass('notice--success');
          $('.page__comments-form .js-notice').addClass('notice--danger');
          showAlert('Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.');
          $(form).removeClass('disabled');
        }
      });

      return false;
    });

    function showAlert(message) {
      $('.page__comments-form .js-notice').removeClass('hidden');
      $('.page__comments-form .js-notice-text').html(message);
    }
  })(jQuery);
  </script>


  





  </body>
</html>
